<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            x:Class="Pangram.Pages.Pangram"
            xmlns:pageModels="clr-namespace:Pangram.PageModels"
            xmlns:sys="clr-namespace:System;assembly=netstandard"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:gconverters="clr-namespace:OpenFun_Core.Converters;assembly=OpenFun_Core"
            xmlns:models="clr-namespace:Pangram.Models"
            mc:Ignorable="d"
             BackgroundColor="#202020"
             Title="Pangram">

    <ContentPage.Resources>
        <Style x:Key="HexButtonStyle" TargetType="Button">
            <Setter Property="HeightRequest" Value="100" />
            <Setter Property="WidthRequest" Value="100" />
            <Setter Property="BackgroundColor" Value="Gray" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="CornerRadius" Value="0" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="HorizontalOptions" Value="Center" />
            <Setter Property="VerticalOptions" Value="Center" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="FontSize" Value="40" />

            <Setter Property="VisualStateManager.VisualStateGroups">
                <VisualStateGroupList>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal" />
                        <VisualState x:Name="PointerOver">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="#6E6E6E" />
                                <Setter Property="TextColor" Value="White" />
                            </VisualState.Setters>
                        </VisualState>
                        <VisualState x:Name="Pressed">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="#2E2E2E" />
                                <Setter Property="TextColor" Value="White" />
                                <Setter Property="Scale" Value="0.98" />
                            </VisualState.Setters>
                        </VisualState>
                        <VisualState x:Name="Disabled">
                            <VisualState.Setters>
                                <Setter Property="Opacity" Value="0.5" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateGroupList>
            </Setter>
        </Style>

        <Style x:Key="CenterHexButtonStyle" TargetType="Button" BasedOn="{StaticResource HexButtonStyle}">
            <Setter Property="BackgroundColor" Value="Orange" />
            <Setter Property="TextColor" Value="Black" />
            <Setter Property="VisualStateManager.VisualStateGroups">
                <VisualStateGroupList>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal" />
                        <VisualState x:Name="PointerOver">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="#FFB74D" />
                                <Setter Property="TextColor" Value="Black" />
                            </VisualState.Setters>
                        </VisualState>
                        <VisualState x:Name="Pressed">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="#E65100" />
                                <Setter Property="TextColor" Value="White" />
                                <Setter Property="Scale" Value="0.98" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateGroupList>
            </Setter>
        </Style>

        <Style x:Key="PressableButtonStyle" TargetType="Button">
            <Setter Property="VisualStateManager.VisualStateGroups">
                <VisualStateGroupList>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal" />
                        <VisualState x:Name="Pressed">
                            <VisualState.Setters>
                                <Setter Property="Scale" Value="0.90" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateGroupList>
            </Setter>
        </Style>

        <ResourceDictionary>
            <gconverters:InvertedBoolConverter x:Key="InvertedBoolConverter" />
            <gconverters:DateTimeToStringConverter x:Key="DateTimeToStringConverter" />
            <gconverters:FirstCharacterConverter x:Key="FirstCharacterConverter" />
            <gconverters:RemainingCharactersConverter x:Key="RemainingCharactersConverter" />
        </ResourceDictionary>
        
    </ContentPage.Resources>


    <Grid RowDefinitions="Auto,*">
        <!--<Label 
            Text="Pangram"
            FontSize="40"
            VerticalOptions="Center" 
            HorizontalOptions="Center"
            Grid.Row="0"/>-->
        
        <HorizontalStackLayout 
            HorizontalOptions="Center" 
            VerticalOptions="Center"
            Grid.Row="1">

            <VerticalStackLayout 
                HorizontalOptions="Fill" 
                VerticalOptions="Fill"
                Margin="0,0,20,0">

                <Button
                    Text="{Binding Sidebar.DisplayText}"
                    Command="{Binding Sidebar.ToggleVisibilityCommand}"
                    IsVisible="{Binding Sidebar.IsVisible}"
                    Style="{StaticResource PressableButtonStyle}"
                    TextColor="Black"
                    BackgroundColor="Azure">
                </Button>
                
                <Border
                    Background="Gray"
                    Margin="0,5,0,0"
                    Padding="5,0,5,0"
                    WidthRequest="200"
                    IsVisible="{Binding Sidebar.IsVisible}">
                    <ListView ItemsSource="{Binding GuessedWords}"
                              HorizontalOptions="Start">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <ViewCell>
                                    <Label 
                                        Text="{Binding .}" 
                                        FontSize="15" 
                                        TextColor="White" 
                                        VerticalOptions="Center" 
                                        HorizontalOptions="Center" 
                                        Padding="0,0,0,0" />
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>
            </VerticalStackLayout>

            <VerticalStackLayout >
                <Border x:Name="CurrentWordBorder"
                        Padding="5"
                        Background="Transparent"
                        StrokeThickness="4"
                        Stroke="{Binding LastGuess.Colour}">
                    <Label
                    Text="{Binding CurrentWord}"
                    FontSize="25"
                        TextColor="White"
                    HorizontalOptions="Center">
                    </Label>
                </Border>

                <Label
                    Text="{Binding LastGuess.Message}"
                    TextColor="{Binding LastGuess.Colour}"
                    IsVisible="{Binding LastGuess.IsVisible}"
                    FontSize="15"
                    HorizontalOptions="Center"
                    Margin="0,5,0,10"/>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Button
                        Text="{Binding Sidebar.DisplayText}"
                        Command="{Binding Sidebar.ToggleVisibilityCommand}"
                        IsVisible="{Binding Sidebar.IsVisible, Converter={StaticResource InvertedBoolConverter}}"
                        TextColor="Black"
                        BackgroundColor="Azure"
                        Style="{StaticResource PressableButtonStyle}"
                        Margin="0,5,5,0"
                        Grid.Column="0">

                    </Button>

                    <Button
                        Text="History"
                        Command="{Binding History.ToggleVisibilityCommand}"
                        IsVisible="{Binding History.IsVisible, Converter={StaticResource InvertedBoolConverter}}"
                        TextColor="Black"
                        BackgroundColor="Azure"
                        Style="{StaticResource PressableButtonStyle}"
                        Margin="5,5,0,0"
                        Grid.Column="1">

                    </Button>

                </Grid>

                
                <HorizontalStackLayout HorizontalOptions="Center"
                                       Margin="0,20,0,0">
                    <Button
                        Margin="0,0,20,0"
                        WidthRequest="80"
                        HeightRequest="20"
                        FontSize="20"
                        Text="&lt;|"
                        BackgroundColor="Red"
                        TextColor="White"
                        Style="{StaticResource PressableButtonStyle}"
                        IsEnabled="{Binding Loading.HasLoaded}"
                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.RemoveLetterCommand}">
                    </Button>
                    
                    <Button
                        Margin="20,0,0,0"
                        WidthRequest="80"
                        HeightRequest="20"
                        Text="Submit"
                        BackgroundColor="Green"
                        TextColor="White"
                        Style="{StaticResource PressableButtonStyle}"
                        IsEnabled="{Binding Loading.HasLoaded}"
                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SubmitWordCommand}">
                    </Button>
                </HorizontalStackLayout>

                <AbsoluteLayout WidthRequest="275" 
                                HeightRequest="250" 
                                Margin="0,20,0,20" 
                                HorizontalOptions="Center" 
                                Background="Transparent">
                    <!-- top-left -->
                    <Button Style="{StaticResource HexButtonStyle}" 
          Text="{Binding OtherCharacters[0]}"
          Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddLetterCommand}"
          CommandParameter="{Binding OtherCharacters[0]}"
          AbsoluteLayout.LayoutBounds="44,0,100,100"
          AbsoluteLayout.LayoutFlags="None">
                        <Button.Clip>
                            <PathGeometry Figures="M50,0 L95,25 L95,75 L50,100 L5,75 L5,25 Z" />
                        </Button.Clip>
                    </Button>

                    <!-- top-right -->
                    <Button Style="{StaticResource HexButtonStyle}"
          Text="{Binding OtherCharacters[1]}"
          Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddLetterCommand}"
          CommandParameter="{Binding OtherCharacters[1]}"
          AbsoluteLayout.LayoutBounds="134,0,100,100"
          AbsoluteLayout.LayoutFlags="None">
                        <Button.Clip>
                            <PathGeometry Figures="M50,0 L95,25 L95,75 L50,100 L5,75 L5,25 Z" />
                        </Button.Clip>
                    </Button>

                    <!-- left middle -->
                    <Button Style="{StaticResource HexButtonStyle}"
          Text="{Binding OtherCharacters[2]}"
          Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddLetterCommand}"
          CommandParameter="{Binding OtherCharacters[2]}"
          AbsoluteLayout.LayoutBounds="0,74,100,100"
          AbsoluteLayout.LayoutFlags="None">
                        <Button.Clip>
                            <PathGeometry Figures="M50,0 L95,25 L95,75 L50,100 L5,75 L5,25 Z" />
                        </Button.Clip>
                    </Button>

                    <!-- center -->
                    <Button Style="{StaticResource CenterHexButtonStyle}"
          Text="{Binding PrimeCharacter}"
          Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddLetterCommand}"
          CommandParameter="{Binding PrimeCharacter}"
          AbsoluteLayout.LayoutBounds="89,74,100,100"
          AbsoluteLayout.LayoutFlags="None">
                        <Button.Clip>
                            <PathGeometry Figures="M50,0 L95,25 L95,75 L50,100 L5,75 L5,25 Z" />
                        </Button.Clip>
                    </Button>

                    <!-- right middle -->
                    <Button Style="{StaticResource HexButtonStyle}"
          Text="{Binding OtherCharacters[3]}"
          Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddLetterCommand}"
          CommandParameter="{Binding OtherCharacters[3]}"
          AbsoluteLayout.LayoutBounds="178,74,100,100"
          AbsoluteLayout.LayoutFlags="None">
                        <Button.Clip>
                            <PathGeometry Figures="M50,0 L95,25 L95,75 L50,100 L5,75 L5,25 Z" />
                        </Button.Clip>
                    </Button>

                    <!-- bottom-left -->
                    <Button Style="{StaticResource HexButtonStyle}"
          Text="{Binding OtherCharacters[4]}"
          Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddLetterCommand}"
          CommandParameter="{Binding OtherCharacters[4]}"
          AbsoluteLayout.LayoutBounds="44,147,100,100"
          AbsoluteLayout.LayoutFlags="None">
                        <Button.Clip>
                            <PathGeometry Figures="M50,0 L95,25 L95,75 L50,100 L5,75 L5,25 Z" />
                        </Button.Clip>
                    </Button>

                    <!-- bottom-right -->
                    <Button Style="{StaticResource HexButtonStyle}"
          Text="{Binding OtherCharacters[5]}"
          Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddLetterCommand}"
          CommandParameter="{Binding OtherCharacters[5]}"
          AbsoluteLayout.LayoutBounds="134,147,100,100"
          AbsoluteLayout.LayoutFlags="None">
                        <Button.Clip>
                            <PathGeometry Figures="M50,0 L95,25 L95,75 L50,100 L5,75 L5,25 Z" />
                        </Button.Clip>
                    </Button>
                </AbsoluteLayout>

                <Button
                    Text="Shuffle"
                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.JumbleLettersCommand}"
                    IsEnabled="{Binding Loading.HasLoaded}"
                    WidthRequest="100"
                    TextColor="Black"
                    BackgroundColor="Azure"
                    Style="{StaticResource PressableButtonStyle}"
                    Margin="10,0,0,20">
                </Button>
                
                <HorizontalStackLayout HorizontalOptions="Center">
                    <Button
                        Text="Random"
                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.NewGameCommand}"
                        CommandParameter="{x:Static sys:Boolean.FalseString}"
                        WidthRequest="100"
                        IsEnabled="{Binding Loading.IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                        TextColor="Black"
                        BackgroundColor="Azure"
                        Style="{StaticResource PressableButtonStyle}"
                        Margin="0,0,10,0">
                    </Button>

                    <Button
                        Text="Daily"
                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.NewGameCommand}"
                        CommandParameter="{x:Static sys:Boolean.TrueString}"
                        WidthRequest="100"
                        IsEnabled="{Binding Loading.IsLoading, Converter={StaticResource InvertedBoolConverter}}"
                        TextColor="Black"
                        BackgroundColor="Azure"
                        Style="{StaticResource PressableButtonStyle}"
                        Margin="10,0,0,0">
                    </Button>
                </HorizontalStackLayout>

                <Label
                    HorizontalOptions="Center"
                    Margin="0,5,0,0"
                    IsVisible="{Binding Loading.IsLoading}"
                    TextColor="Green">
                    Loading ...
                </Label>
            </VerticalStackLayout>

            <VerticalStackLayout 
                HorizontalOptions="Fill" 
                VerticalOptions="Fill"
                Margin="20,0,0,0">

                <Button
                    Text="History"
                    Command="{Binding History.ToggleVisibilityCommand}"
                    IsVisible="{Binding History.IsVisible}"
                    Style="{StaticResource PressableButtonStyle}"
                    TextColor="Black"
                    BackgroundColor="Azure">
                </Button>

                <Border
                    Background="Gray"
                    Margin="0,5,0,0"
                    Padding="5,0,5,0"
                    WidthRequest="200"
                    IsVisible="{Binding History.IsVisible}">
                    <ListView ItemsSource="{Binding History.PangramHistory}"
                              HorizontalOptions="Start">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="pageModels:PangramDataVM">
                                <ViewCell>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <Label 
                                            Text="{Binding Source={RelativeSource Mode=FindAncestorBindingContext, AncestorType={x:Type pageModels:PangramDataVM}},
                                            Path=PangramData.Date, 
                                            Converter={StaticResource DateTimeToStringConverter}}" 
                                            FontSize="15" 
                                            TextColor="White" 
                                            VerticalOptions="Center" 
                                            HorizontalOptions="Start" 
                                            Padding="0,0,0,0" 
                                            Grid.Row="0"
                                            Grid.Column="0"/>

                                        <Label 
                                            VerticalOptions="Center" 
                                            HorizontalOptions="End" 
                                            Padding="0,0,0,0"
                                            Grid.Row="0"
                                            FontFamily="IBMPlexMonoRegular"
                                            Grid.Column="1">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding Source={RelativeSource Mode=FindAncestorBindingContext, AncestorType={x:Type pageModels:PangramDataVM}},
                                                        Path=PangramData.LetterSequence, 
                                                        Converter={StaticResource FirstCharacterConverter}}" 
                                                          TextColor="Orange" FontAttributes="Bold" FontSize="15" FontFamily="IBMPlexMonoRegular"/>
                                                    <Span Text="{Binding Source={RelativeSource Mode=FindAncestorBindingContext, AncestorType={x:Type pageModels:PangramDataVM}},
                                                        Path=PangramData.LetterSequence, 
                                                        Converter={StaticResource RemainingCharactersConverter}}" 
                                                          TextColor="White" FontSize="15" FontFamily="IBMPlexMonoRegular"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </Grid>
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>
            </VerticalStackLayout>
        </HorizontalStackLayout>
    </Grid>
</ContentPage>